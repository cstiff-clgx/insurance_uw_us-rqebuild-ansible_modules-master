- name: "Create temp dir"
  win_file:
    state: directory
    path: "{{ temp_dir }}"

- name: Copy template preparation script to deploy dir
  win_template:
    src: waiter.ps1.j2
    dest: "{{ temp_dir }}\\waiter.ps1"

- name: Run preparation script from PD
  win_shell: "{{ temp_dir }}\\waiter.ps1"
  register: script_output
  become: yes
  become_user: rqe
  become_method: runas
  become_flags: logon_type=interactive logon_flags=with_profile

- name: Print prep installation script output
  debug: 
    msg: "{{ script_output.stdout.split('\r') }}"

- name: Print prep installation script ERRORS output
  debug: 
    msg: "{{ script_output.stderr.split('\r') }}"

- name: Delete autogenerated prep script
  win_file:
    path: "{{ temp_dir }}\\waiter.ps1"
    state: absent
